<!DOCTYPE html>
<!--  lastBuildDate : Wed, 10 Aug 2016 09:40:55 +0200 -->
<html>
<head>
  <title></title>
  <!-- Meta -->
  <meta charset="utf-8">
  <!-- Google site verification -->
  <meta name="google-site-verification" content="Gq_ytzUtfYn95WsiH66e4Lfb8zANT-LUwD8JgH9xXdw" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="Expertise informatique, Dévelopement informatique" />
  <meta name="description" content="Société de conseil et d'expertise en informatique spécialisée dans les nouvelles technologies." />
  <meta name="author" content="">
  <!-- Begin SEO tags -->
































  <meta property="og:title" content="" />



  <meta name="description" content="Le but de cet exercice était d’utiliser toutes les solutions possibles, hormis le cache pour améliorer les requêtes.La JVM ayant plein d’astuce d’optimisation (comme la compilation en code natif à chaud JIT), il est vite compliqué de faire des benchmarks ‘valable’ en Java.La solution la plus simple est d’utiliser JMH qui est la solution officiel pour la JVM." />
  <meta property="og:description" content="Le but de cet exercice était d’utiliser toutes les solutions possibles, hormis le cache pour améliorer les requêtes.La JVM ayant plein d’astuce d’optimisation (comme la compilation en code natif à chaud JIT), il est vite compliqué de faire des benchmarks ‘valable’ en Java.La solution la plus simple est d’utiliser JMH qui est la solution officiel pour la JVM." />



  <link rel="canonical" href="http://www.monkeypatch.io/en/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html" />
  <meta property="og:url" content="http://www.monkeypatch.io/en/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html" />



  <meta property="og:site_name" content="MonkeyPatch - Expertise Informatique" />








  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2016-08-12T00:00:00+02:00" />






  
    <meta name="twitter:card" content="summary" />
  

  <meta name="twitter:site" content="@MonkeyPatch_io" />

  
    <meta name="twitter:creator" content="@EmmanuelVinas" />
  






<script type="application/ld+json">
  {
    "@context": "http://schema.org",

    "@type": "BlogPosting",



    "headline": "",



    "datePublished": "2016-08-12T00:00:00+02:00",


    "description": "Le but de cet exercice était d’utiliser toutes les solutions possibles, hormis le cache pour améliorer les requêtes.La JVM ayant plein d’astuce d’optimisation (comme la compilation en code natif à chaud JIT), il est vite compliqué de faire des benchmarks ‘valable’ en Java.La solution la plus simple est d’utiliser JMH qui est la solution officiel pour la JVM.",


    "logo": "http://www.monkeypatch.io/en/public/images/logos/logo-mkp-blue.png",


    "url": "http://www.monkeypatch.io/en/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html"
  }
</script>

<!-- End Jekyll SEO tag -->

  
  
  <link rel="alternate" hreflang="fr" href="http://www.monkeypatch.io/index" />
  

  <link rel="shortcut icon" href="favicon.ico">
  
  <!-- Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Fira+Mono:400,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <!-- Style -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
  <link id="theme-style" rel="stylesheet" href="/css/main.css">
</head>

<body class="post">
  <header>
  <div class="menu">
    <div class="logo">
      <a href="/en/index">
        <img alt="Monkey Patch" src="/public/images/logos/logo-monkey.svg">
      </a>
    </div>
    
    <nav class="lang">
      <ul>
        <li class="active">
          <a href="en/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html" >EN</a>
        </li>
        <li class="sep">|</li>
        <li class="">
          <a href="/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html" >FR</a>
        </li>
      </ul>
    </nav>
    
    <nav class="menu">
      <ul>
        
        
          
        
          
        
          
        
          
        
          
        
          
            <li class="">
              <a href="/en/expert">Our expertise</a>
            </li>
          
        
          
            <li class="">
              <a href="/en/about">Our thoughts</a>
            </li>
          
        
          
            <li class="">
              <a href="/en/careers">Be a Monkey</a>
            </li>
          
        
          
            <li class="">
              <a href="/en/job">Our Jobs</a>
            </li>
          
        
          
            <li class="">
              <a href="/en/contact">Contact</a>
            </li>
          
        
        <li class="">
          <a href="/en/blog">Blog</a>
        </li>
      </ul>
    </nav>
      
    <nav class="hamburger">
      <label for="menu-hamburger">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </label>
    </nav>
    
  </div>
  <input type="checkbox" id="menu-hamburger"/>
  <nav class="menu-hamburger">
     <ul>
        
          
        
          
        
          
        
          
        
          
        
          
            <li class="">
              <a href="/en/expert">Our expertise</a>
            </li>
          
        
          
            <li class="">
              <a href="/en/about">Our thoughts</a>
            </li>
          
        
          
            <li class="">
              <a href="/en/careers">Be a Monkey</a>
            </li>
          
        
          
            <li class="">
              <a href="/en/job">Our Jobs</a>
            </li>
          
        
          
            <li class="">
              <a href="/en/contact">Contact</a>
            </li>
          
        
      </ul>
      <ul class="lang">
        <li class="active">
          <a href="en/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html" >EN</a>
        </li>
        <li class="">
          <a href="/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html" >FR</a>
        </li>
      </ul>
  </nav>
</header>
<a id="top"></a>

  <section class="post">
    <h1>
      <span>Mktd#1 Feign Vs Retrofit 3 Autres Sujets</span>
      <span class="date">

  12 August, 2016

</span>
      <div class="authors">
        
          <span>Emmanuel Vinas</span> 
        
          <span>Igor Laborie</span> 
        
      </div>
      <!--<a href="#disqus_thread" class="count"><script id="dsq-count-scr" src="//monkeypatchblog.disqus.com/count.js" async></script></a>-->
    </h1>

    <div class="tags">
      
        <span>MKTD</span> 
      
        <span>Java</span> 
      
        <span>REST</span> 
      
        <span>Feign</span> 
      
        <span>Retrofit</span> 
      
        <span>Android</span> 
      
        <span>RxJava</span> 
       
    </div>

    <article><p>Le but de cet exercice était d’utiliser toutes les solutions possibles, hormis le cache pour améliorer les requêtes.
La JVM ayant plein d’astuce d’optimisation (comme la compilation en code natif à chaud JIT), il est vite compliqué de faire des benchmarks ‘valable’ en Java.
La solution la plus simple est d’utiliser <a href="http://openjdk.java.net/projects/code-tools/jmh/">JMH</a> qui est la solution <em>officiel</em> pour la JVM. <!--more--></p>

<p><a href="/2016/08/09/MKTD-1-feign-vs-retrofit-1-prise-en-main.html"><abbr title="MonkeyTechDays">MKTD</abbr>#1 Article précédent: Prise en main</a>
<a href="/2016/08/10/MKTD-1-feign-vs-retrofit-2-aller-plus-loin.html"><abbr title="MonkeyTechDays">MKTD</abbr>#1 Article précédent: Aller plus loin</a></p>

<h2 id="jhm">JHM</h2>

<p>Voici le code utiliser pour faire ces tests de performances:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RestClientBenchmark</span> <span class="o">{</span>

    <span class="nd">@State</span><span class="o">(</span><span class="n">Scope</span><span class="o">.</span><span class="na">Benchmark</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">BenchmarkConfiguration</span> <span class="o">{</span>
        <span class="nd">@Param</span><span class="o">({</span><span class="s">"1"</span><span class="o">,</span> <span class="s">"10"</span><span class="o">,</span> <span class="s">"100"</span><span class="o">})</span>
        <span class="kt">int</span> <span class="n">nbPages</span><span class="o">;</span>
        <span class="n">MonkeyApi</span> <span class="n">api</span><span class="o">;</span>

        <span class="nd">@Setup</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">Trial</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getApi</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">api</span> <span class="o">=</span> <span class="n">ApiFactory</span><span class="o">.</span><span class="na">buildMonkeyApi</span><span class="o">(</span><span class="n">BASE_URL</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Benchmark</span>
    <span class="nd">@Warmup</span><span class="o">(</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">timeUnit</span> <span class="o">=</span> <span class="n">SECONDS</span><span class="o">)</span>
    <span class="nd">@Measurement</span><span class="o">(</span><span class="n">iterations</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">time</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">timeUnit</span> <span class="o">=</span> <span class="n">SECONDS</span><span class="o">)</span>
    <span class="nd">@BenchmarkMode</span><span class="o">(</span><span class="n">Throughput</span><span class="o">)</span>
    <span class="nd">@Fork</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">load_monkeys</span><span class="o">(</span><span class="n">BenchmarkConfiguration</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">config</span><span class="o">.</span><span class="na">nbPages</span><span class="o">)</span>
                <span class="o">.</span><span class="na">parallel</span><span class="o">()</span>
                <span class="o">.</span><span class="na">mapToObj</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">api</span><span class="o">::</span><span class="n">getMonkeys</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="nl">Page:</span><span class="o">:</span><span class="n">getContent</span><span class="o">)</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">Collection:</span><span class="o">:</span><span class="n">stream</span><span class="o">)</span>
                <span class="o">.</span><span class="na">count</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<p>Il est bien sur trés intéressant d’ajouter des <code class="highlighter-rouge">@Benchmark</code> pour tester dans les mêmes conditions sans le parallélisme de la <code class="highlighter-rouge">Stream</code>, ou avec des <abbr title="Application Programming Interface">API</abbr> asynchronnes comme <code class="highlighter-rouge">RxJava</code>, ou les <code class="highlighter-rouge">CompletableFuture</code> de Java 8.</p>

<h2 id="feign">Feign</h2>

<p>TODO</p>

<h2 id="retrofit">Retrofit</h2>
<p>Étant donné que nous étions dans un environnement déjà multi-threadé nous nous sommes concentré sur la partie optimisation de la sérialisation/désérialisation du <abbr title="JavaScript Object Notation">JSON</abbr>. Pour ça nous avons testé plusieurs converters disponibles pour retrofit. 
<a href="">Gson</a>, <a href="">Jackson</a>, <a href="">Moshi</a> et <a href="">LoganSquare</a></p>

<p>Dans notre cas de test, Jackson nous a semblé plus performant que Gson. 
Nous pensions que Moshi allait être encore plus performant étant donné qu’il utilise <a href="https://github.com/square/okio">Okio</a> (décrites par <a href="https://github.com/JakeWharton">Jake Wharton</a> lors de la <a href="https://youtu.be/KIAoQbAu3eA?t=1548">Droidcon NYC 2015</a> et pourtant Moshi est la librairie qui nous a donné les moins bonnes performances.
LoganSquare a été la librairie qui nous a donné les meilleures performances. Celui est surement du au faire qu’elle utilise une phase d’optimisation lors de la compilation et donc il y a moins besoin de reflexion.</p>

<p>Voici les résultats que nous avons obtenu avec notre machine:</p>

<p>TODO</p>

<h2 id="bilan">Bilan</h2>

<p>Malheureusement nous avons pas eu le temps d’aborder ces sujets sous la forme d’exercice lors du <abbr title="MonkeyTechDays">MKTD</abbr>, mais nous en avons discuter autour de l’apéro de fin</p>

<ul>
  <li>Cache</li>
  <li>Retry</li>
  <li>Circuit Breaker</li>
  <li>Android</li>
</ul>

<h2 id="cache">Cache</h2>

<h2 id="retry">Retry</h2>

<h2 id="circuit-breaker">Circuit Breaker</h2>

<h2 id="android">Android</h2>

<p>Nous savions que retrofit fonctionne très bien dans un environnement d’application mobile Android mais nous n’avions jamais testé feign dans ces conditions. Nous avons donc créé une petite application mobile qui appelle notre service de récupération des singes un certain nombre de fois. Un bouton étant utilisé pour Appeler le service via feign, un autre en utilisant rétrofit. Ne prenez pas cette application en exemple, elle a été codé en 30 minutes.</p>

<p>Et je dois dire que j’ai été agréablement surpris de voir feign se comporter très bien en environnement Android API16+ et nous n’avons pas pu voir de différence notable de performances entre utiliser feign et utiliser retrofit en environnement mobile à partir du moment où le client est <code class="highlighter-rouge">OkHttp</code>. Nous n’avons pas poussé nos tests en utilisant le client par défaut.</p>

<h1 id="bilan-gnral">Bilan général</h1>

<p>Les deux technologies bien que très semblables disposent chacune de ses forces et ses faiblesses.</p>

<p>Nous n’avons pas trop exploré la partie asynchrone par manque de temps lors de cette journée mais j’aurai tendance à dire qu’en environnement asynchrone il est plus simple d’utiliser Retrofit grâce au système de <code class="highlighter-rouge">CallAdapterFactory</code> qui permet facilement de retourner par exemple un objet <code class="highlighter-rouge">rx.Observable</code>. Cela est aussi possible avec Feign en utilisant l’extension <code class="highlighter-rouge">feign-hystrix</code> (qui apporte aussi l’aspect Circuit Breaker) mais c’est moins souple que ce que l’on peut faire avec Retrofit.</p>

<p>En revanche en environnement synchrone nous avons préféré utiliser Feign pour le fait qu’il n’y ai pas besoin de modifier une interface et pour sa gestion des erreurs plus intuitive et plus simple à mettre en place.</p>

</article>
  </section>
  
  
  <section class="comment">
    <div id="disqus_thread"></div>
    <script>
    var disqus_config = function () {
        this.page.url = "http://www.monkeypatch.io/en/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "/2016/08/12/MKTD-1-feign-vs-retrofit-3-autres-sujets.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//monkeypatchblog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
  

  <footer class="top">
    <div>
      <h3>Get In Touch</h3>
      <p>
        <a class="contact" href="/encontact">
          <i class="fa fa-map-marker" aria-hidden="true"></i>
          <img src="/public/images/icons/Toulouse.png" alt="Toulouse">
        </a>
      </p>
      <p>
        <i class="fa fa-envelope-o" aria-hidden="true"></i>
        <a class="mail" href="mailto:contact@monkeypatch.io">contact@monkeypatch.io</a>
      </p>
    </div>
    <div class="social-network">
      <h3>Social Networks</h3>
      <ul class="social">
        <li>
          <a href="https://twitter.com/monkeypatch_io">
            <i class="fa fa-twitter" aria-hidden="true"></i>
          </a>
        </li>
        <li>
          <a href="https://www.linkedin.com/company/monkeypatch-io">
            <i class="fa fa-linkedin" aria-hidden="true"></i>
          </a>
        </li>
      </ul>
    </div>
  </div>
</footer>

<footer class="bottom">
  <div>
    Copyright @ 2016 MonkeyPatch -<a href="/en/terms">Terms and Conditions</a>
  </div>
  <div>
    Made with <i class="fa fa-heart" aria-hidden="true"></i> In Toulouse
  </div>
  <a class="goToTop" href="#top">
    <i class="fa fa-caret-up" aria-hidden="true"></i>
  </a>
</footer>

  <!-- Google Tag Manager -->
  <noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-KGGFWH" height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript>
  <script>
    (function(w, d, s, l, i) {
      w[l] = w[l] || [];
      w[l].push({
        'gtm.start': new Date().getTime(),
        event: 'gtm.js'
      });
      var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s),
        dl = l != 'dataLayer' ? '&l=' + l : '';
      j.async = true;
      j.src =
        '//www.googletagmanager.com/gtm.js?id=' + i + dl;
      f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-KGGFWH');
  </script>
  <!-- End Google Tag Manager -->
  <script src="/public/scripts/modernizr-custom.js"></script>
  <script src="/public/scripts/main.js"></script>
</body>
</html>




